<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会員証</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; padding: 20px; }
        
        /* 会員証カードのデザイン */
        .card {
            width: 100%; max-width: 350px; height: 200px;
            border-radius: 15px; padding: 20px; color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative; overflow: hidden;
            display: none; /* 最初は隠しておく */
        }

        /* 無料会員のデザイン */
        .card.free {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* 有料会員のデザイン */
        .card.premium {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border: 2px solid #fff;
        }

        .member-rank { font-size: 1.5em; font-weight: bold; }
        .member-name { margin-top: 10px; font-size: 1.2em; }
        .member-id { position: absolute; bottom: 20px; right: 20px; font-family: monospace; opacity: 0.8; }
        
        #loading { margin-top: 50px; font-weight: bold; color: #555; }
    </style>
</head>
<body>

    <div id="loading">会員情報を読み込み中...</div>

    <div id="memberCard" class="card">
        <div class="member-rank" id="rankText">MEMBER</div>
        <div class="member-name" id="nameText">ゲスト様</div>
        <div class="member-id" id="idText">ID: -</div>
    </div>

    <script>
        // ▼▼ 設定項目 ▼▼
        const LIFF_ID = 'YOUR_LIFF_ID'; // LINE Developersで取得したLIFF ID
        const GAS_API_URL = 'YOUR_GAS_WEB_APP_URL'; // さっきコピーしたGASのURL
        // ▲▲▲▲▲▲▲▲▲▲

        async function main() {
            try {
                // 1. LIFF初期化
                await liff.init({ liffId: LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // 2. ユーザー情報の取得
                const profile = await liff.getProfile();
                const userId = profile.userId;
                const displayName = profile.displayName;

                // 3. GASへ問い合わせ（POST送信）
                // GASの仕様上、CORSエラーが出ても実際には成功している場合があるが、
                // fetchのmode: 'no-cors' ではなく、標準的なPOSTを行いテキストで受け取る構成にする。
                // ※GitHub PagesとGAS間では redirect: 'follow' が重要です。
                
                const response = await fetch(GAS_API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ userId: userId, displayName: displayName })
                });
                
                const json = await response.json();
                
                if (json.status === 'success') {
                    renderCard(json.data);
                } else {
                    alert('データ取得エラー: ' + json.message);
                }

            } catch (err) {
                console.error(err);
                document.getElementById('loading').textContent = 'エラーが発生しました。';
                // PCなどで直接開いた場合のテスト用アラート
                // alert('Error: ' + err); 
            }
        }

        function renderCard(userData) {
            const card = document.getElementById('memberCard');
            const rankText = document.getElementById('rankText');
            const nameText = document.getElementById('nameText');
            const idText = document.getElementById('idText');

            // 画面反映
            nameText.textContent = userData.name + ' 様';
            idText.textContent = 'ID: ' + userData.userId.substring(0, 8) + '...';

            // デザインの出し分け
            card.classList.remove('free', 'premium'); // 一旦リセット
            if (userData.memberType === 'premium') {
                card.classList.add('premium');
                rankText.textContent = '✨ PREMIUM MEMBER';
            } else {
                card.classList.add('free');
                rankText.textContent = 'REGULAR MEMBER';
            }

            // 表示切り替え
            document.getElementById('loading').style.display = 'none';
            card.style.display = 'block';
        }

        main();
    </script>
</body>
</html>
